<% content_for(:body_class, "full-page") %>

<div class="insert-image">
  <div class="wrapper-blue">
    <h1>Prenez une photo</h1>
    <%= simple_form_for @poll, class: "add_photo" do |f| %>
      <%= f.input :photo, as: :attachinary, label: false %>
    <% end %>
  </div>
</div>

<div class="poll">
  <div class="image-upload">
  </div>
  <%= form_for @poll do |f| %>
    <div class="poll-text">
      <%= f.text_field :context %>
    </div>
    <div class="poll-button">
      <%= f.button :submit, class: "btn btn-primary" %>
    </div>
  <% end %>
</div>

<% content_for(:after_js) do %>
  <script>
    $(function(){

    $(".poll").hide();
    $(".attachinary-input").hide();

    $(".insert-image").one("click", function() {

      $(".attachinary-input").click();

    });

    $('.attachinary-input').fileupload().on('fileuploaddone', function (e, data) {
       var $url =  $('#new_poll > div > div > input[type="hidden"]')["0"].defaultValue.split(",")[13].split('"')[3];

       $(".image-upload").append("<img class='photo_poll' src='" + $url + "'/>");
       $(".poll").show()
       $(".insert-image").hide()

       var $pollText = $(".poll-text");

      $(document).on('touchstart', function(event){
        var positionY = event.originalEvent.changedTouches["0"].clientY
        $pollText.css({ top: positionY });
      });

      $(document).on('touchmove', function(event){
        var positionY = event.originalEvent.changedTouches["0"].clientY
        $pollText.css({ top: positionY });
      });

    });

  });

  </script>
<% end %>

