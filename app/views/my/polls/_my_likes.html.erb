<% @favourites.each do |favourite| %>

<%= link_to my_poll_path(favourite.poll) do %>
  <% cl_image_tag(favourite.poll.photo.path, class: "min-photo-poll") %>
<% end %>

<% if favourite.poll.context.size < 30 %>
  <%= favourite.poll.context %>
<% else %>
  <%= favourite.poll.context.first(30) + "... " %>
<% end %>

<% if favourite.poll.anonym %>
  <%= image_tag "anonym.png", height: 20 %>
<% else %>
  <%= image_tag "monkey.png", height: 20 %>
<% end %>

<%= image_tag "smiley-coeur.png", height: 20 %>
<%= favourite.poll.yays_count%>

<%= image_tag "pile-of-poo.png", height: 20 %>
<%= favourite.poll.nays_count%>


<div class="poll-timer">
  <div id="timer<%= favourite.poll.id %>" class ="text-center">
    <% if  favourite.poll.ends_at >  Time.zone.now %>
      <p><span id="timer-val"><%= ((favourite.poll.ends_at - Time.zone.now) / 60).to_i %></span> min.</p>
      <i class="fa fa-clock-o" aria-hidden="true"></i>
    <% else %>
      <p>Over</p>
    <% end %>
  </div>
</div>


<% content_for(:after_js) do %>
    <script>
      // Set the date we're counting down to (@choogle.due_at)
      var pollEndAt<%= favourite.poll.id %> = '<%= favourite.poll.ends_at %>';
      var countDownDate<%= favourite.poll.id %> = parseDate(pollEndAt<%= favourite.poll.id %>);
      // Update the count down every 1 second
      var x<%= favourite.poll.id %> = setInterval(function() {
        // Get todays date and time
        var now = new Date().getTime();
        // Find the distance between now an the count down date
        var distance<%= favourite.poll.id %> = countDownDate<%= favourite.poll.id %> - now;
        // Time calculations for days, hours, minutes and seconds
        //var days = Math.floor(distance / (1000 * 60 * 60 * 24));
        var hours<%= favourite.poll.id %> = Math.floor((distance<%= favourite.poll.id %> % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes<%= favourite.poll.id %> = Math.floor((distance<%= favourite.poll.id %> % (1000 * 60 * 60)) / (1000 * 60));
        var seconds<%= favourite.poll.id %> = Math.floor((distance<%= favourite.poll.id %> % (1000 * 60)) / 1000);
        // Display the result in the element with id="demo"
        if (hours<%= favourite.poll.id %> > 0) {
        document.getElementById("timer<%= favourite.poll.id %>").innerHTML = hours<%= favourite.poll.id %> + "h";
         } else if (minutes<%= favourite.poll.id %> < 0) {
          document.getElementById("timer<%= favourite.poll.id %>").innerHTML = seconds<%= favourite.poll.id %> + "s";
         } else {
          document.getElementById("timer<%= favourite.poll.id %>").innerHTML = minutes<%= favourite.poll.id %> + "min";
         }
        // If the count down is finished, write some text
        if (distance<%= favourite.poll.id %> < 0) {
          clearInterval(x<%= favourite.poll.id %>);
          document.getElementById("timer<%= favourite.poll.id %>").innerHTML = "Over";
        }
      }, 1000);
    </script>
  <% end %>

<% end %>
